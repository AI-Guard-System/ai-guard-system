"use strict";(()=>{var ie=Object.defineProperty;var Qe=(i,s,r)=>s in i?ie(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r;var et=(i,s)=>()=>(i&&(s=i(i=0)),s);var tt=(i,s)=>{for(var r in s)ie(i,r,{get:s[r],enumerable:!0})};var oe=(i,s,r)=>Qe(i,typeof s!="symbol"?s+"":s,r);var fe={};tt(fe,{default:()=>it});async function st(i={}){var s,r=i,a=!!globalThis.window,o=!!globalThis.WorkerGlobalScope,l=globalThis.process?.versions?.node&&globalThis.process?.type!="renderer",S=[],c="./this.program",g=ot.url,R="",b,f;if(a||o){try{R=new URL(".",g).href}catch{}o&&(f=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),b=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var m=console.log.bind(console),y=console.error.bind(console),_,A=!1;function d(e){for(var t=0,n=e.length,u=new Uint8Array(n),v;t<n;++t)v=e.charCodeAt(t),u[t]=~v>>8&v;return u}var I,x,j,k,C,me,ge,de,he,ye,ve,Ee,G=!1;function Re(){var e=ae.buffer;j=new Int8Array(e),C=new Int16Array(e),k=new Uint8Array(e),me=new Uint16Array(e),ge=new Int32Array(e),de=new Uint32Array(e),he=new Float32Array(e),ye=new Float64Array(e),ve=new BigInt64Array(e),Ee=new BigUint64Array(e)}function _e(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Me(r.preRun.shift());V(L)}function Se(){G=!0,O.b()}function we(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Ne(r.postRun.shift());V(K)}function be(e){r.onAbort?.(e),e="Aborted("+e+")",y(e),A=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw x?.(t),t}var Z;function Ie(){return d('\0asm\0\0\0`\x7F\x7F`\0\x7F`\x7F\0`\0\0\0\0\x07\xA2\x80\x80	\x7FA\x90\x90\x84\v\x07a\0b\0c\0d\0e\0f\0\0\f\n\xC1\0#\0\v\0#\0 \0kApq"\0$\0 \0\v\0 \0$\0\v\x9E\b\x7FA\x7F!A\x80\bA\x7F6\0@\x7F@@ \0"\x07AqE\r\0A\0 \0-\0\0E\r@ \0Aj"\0AqE\r \0-\0\0\r\0\v\f\v@ \0"Aj!\0A\x80\x82\x84\b (\0"\bk \brA\x80\x81\x82\x84xqA\x80\x81\x82\x84xF\r\0\v@ "\0Aj! \0-\0\0\r\0\v\v \0 \x07k\v"A\0L\r\0\x7F@A\xFF\xFF\xFF\0 A\xFF\xFF\xFF\0F\r   \x07j-\0\0"\0:\0\x90 Aq!A\0!@ \r\0 \0A\xDC\0F@A!\f\v \0A"F@ As!\f\v Aq@A!\f\v@@@ \0A\xDB\0G@ \0A\xFB\0G\r A\xFE\x07J\rA\0!A\x80\b Aj"\x006\0 A\x91\bjA\xFD\0:\0\0 \0!\f\v A\xFE\x07J\rA\0!A\x80\b Aj"\x006\0 A\x91\bjA\xDD\0:\0\0 \0!\f\vA\0! \0A\xDFqA\xDD\0G\r A\0H\r -\0\x90\b \0G\rA\x80\b Ak"6\0\f\vA\0!\v\v Aj" G\r\0\v \v! Aq@ A":\0\x90 Aj!\vA\0! A\0H\r\0@ AqAF@ !\f\v AjAq!\0 !@ A\x90j -\0\x90\b:\0\0 Aj! Ak! Aj" \0G\r\0\v\v AO@@ A\x90j A\x90\bj-\0\0:\0\0 A\x91j A\x8F\bj-\0\0:\0\0 A\x92j A\x8E\bj-\0\0:\0\0 A\x93j A\x8D\bj-\0\0:\0\0 Aj! AG Ak!\r\0\v\vA\x80\bA\x7F6\0\v A\x90jA\0:\0\0A\x90\v\0\v\v\v\0A\x80\b\v\xFF\xFF\xFF\xFF')}function lt(e){return e}async function Te(e){return e}async function Pe(e,t){try{var n=await Te(e),u=await WebAssembly.instantiate(n,t);return u}catch(v){y(`failed to asynchronously prepare wasm: ${v}`),be(v)}}async function xe(e,t,n){return Pe(t,n)}function je(){var e={a:Le};return e}async function ke(){function e(E,p){return O=E.exports,Ke(O),Re(),O}function t(E){return e(E.instance)}var n=je();if(r.instantiateWasm)return new Promise((E,p)=>{r.instantiateWasm(n,(h,P)=>{E(e(h,P))})});Z??(Z=Ie());var u=await xe(_,Z,n),v=t(u);return v}class ft{constructor(t){oe(this,"name","ExitStatus");this.message=`Program terminated with exit(${t})`,this.status=t}}for(var V=e=>{for(;e.length>0;)e.shift()(r)},K=[],Ne=e=>K.push(e),L=[],Me=e=>L.push(e),Ce=!0,De=e=>te(e),Oe=()=>ne(),Y=e=>{var t=r["_"+e];return t},Be=(e,t)=>{j.set(e,t)},Ue=e=>{for(var t=0,n=0;n<e.length;++n){var u=e.charCodeAt(n);u<=127?t++:u<=2047?t+=2:u>=55296&&u<=57343?(t+=4,++n):t+=3}return t},Fe=(e,t,n,u)=>{if(!(u>0))return 0;for(var v=n,E=n+u-1,p=0;p<e.length;++p){var h=e.codePointAt(p);if(h<=127){if(n>=E)break;t[n++]=h}else if(h<=2047){if(n+1>=E)break;t[n++]=192|h>>6,t[n++]=128|h&63}else if(h<=65535){if(n+2>=E)break;t[n++]=224|h>>12,t[n++]=128|h>>6&63,t[n++]=128|h&63}else{if(n+3>=E)break;t[n++]=240|h>>18,t[n++]=128|h>>12&63,t[n++]=128|h>>6&63,t[n++]=128|h&63,p++}}return t[n]=0,n-v},We=(e,t,n)=>Fe(e,k,t,n),X=e=>re(e),$e=e=>{var t=Ue(e)+1,n=X(t);return We(e,n,t),n},Q=globalThis.TextDecoder&&new TextDecoder,He=(e,t,n,u)=>{var v=t+n;if(u)return v;for(;e[t]&&!(t>=v);)++t;return t},Je=(e,t=0,n,u)=>{var v=He(e,t,n,u);if(v-t>16&&e.buffer&&Q)return Q.decode(e.subarray(t,v));for(var E="";t<v;){var p=e[t++];if(!(p&128)){E+=String.fromCharCode(p);continue}var h=e[t++]&63;if((p&224)==192){E+=String.fromCharCode((p&31)<<6|h);continue}var P=e[t++]&63;if((p&240)==224?p=(p&15)<<12|h<<6|P:p=(p&7)<<18|h<<12|P<<6|e[t++]&63,p<65536)E+=String.fromCharCode(p);else{var N=p-65536;E+=String.fromCharCode(55296|N>>10,56320|N&1023)}}return E},ze=(e,t,n)=>e?Je(k,e,t,n):"",ee=(e,t,n,u,v)=>{var E={string:w=>{var B=0;return w!=null&&w!==0&&(B=$e(w)),B},array:w=>{var B=X(w.length);return Be(w,B),B}};function p(w){return t==="string"?ze(w):t==="boolean"?!!w:w}var h=Y(e),P=[],N=0;if(u)for(var M=0;M<u.length;M++){var se=E[n[M]];se?(N===0&&(N=Oe()),P[M]=se(u[M])):P[M]=u[M]}var W=h(...P);function Xe(w){return N!==0&&De(N),p(w)}return W=Xe(W),W},qe=(e,t,n,u)=>{var v=!n||n.every(p=>p==="number"||p==="boolean"),E=t!=="string";return E&&v&&!u?Y(e):(...p)=>ee(e,t,n,p,u)},D=new Uint8Array(123),T=25;T>=0;--T)D[48+T]=52+T,D[65+T]=T,D[97+T]=26+T;if(D[43]=62,D[47]=63,r.noExitRuntime&&(Ce=r.noExitRuntime),r.print&&(m=r.print),r.printErr&&(y=r.printErr),r.wasmBinary&&(_=r.wasmBinary),r.arguments&&(S=r.arguments),r.thisProgram&&(c=r.thisProgram),r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()();r.ccall=ee,r.cwrap=qe;var Ge,te,re,ne,Ze,Ve,ae;function Ke(e){Ge=r._repair_json=e.c,te=e.d,re=e.e,ne=e.f,Ze=ae=e.a,Ve=e.__indirect_function_table}var Le={};function Ye(){_e();function e(){r.calledRun=!0,!A&&(Se(),I?.(r),r.onRuntimeInitialized?.(),we())}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),e()},1)):e()}var O;return O=await ke(),Ye(),G?s=r:s=new Promise((e,t)=>{I=e,x=t}),s}var ot,it,ue=et(()=>{"use strict";ot={};it=st});var ce={CREDIT_CARD:/\b(?:\d{4}[ -]?){3}\d{4}\b/,EMAIL:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/,API_KEY:/\b(sk-[a-zA-Z0-9]{20,}|ghp_[a-zA-Z0-9]{36}|gho_[a-zA-Z0-9]{36})\b/,SSN:/\b\d{3}-\d{2}-\d{4}\b/,IPV4:/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/,AWS_KEY:/\b(AKIA[0-9A-Z]{16})\b/,JWT:/\beyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*\b/},rt={SSN:["ssn","social","security","number","id"],CREDIT_CARD:["cc","card","visa","amex","mastercard","payment"],API_KEY:["key","api","secret","token"],EMAIL:["email","contact","mail"]};function $(i,s={}){let{rules:r=Object.keys(ce),redact:a=!1,allow:o=[],mode:l="block"}=s,S=i,c=[],g=!0,R=o.map(f=>typeof f=="string"?new RegExp(f):f);for(let f of r){let m=ce[f];if(!m)continue;let y=new RegExp(m.source,"g"),_;for(;(_=y.exec(i))!==null;){let A=_[0],d=_.index;if(R.some(C=>C.test(A)))continue;let I=Math.max(0,d-25),x=i.slice(I,d).toLowerCase(),j=0,k=rt[f]||[];k.length>0&&k.some(C=>x.includes(C))&&(j=1),c.push({type:f,match:A,context:j>0?"supported":"neutral"}),g=!1}}if(!g&&(a||l==="block")){let f=[...new Set(c.map(m=>m.match))];for(let m of f){let y=c.find(A=>A.match===m)?.type||"PII",_=m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");S=S.replace(new RegExp(_,"g"),`[${y}_REDACTED]`)}}return{hasPII:!g,status:g?"safe":l==="warn"?"warning":"blocked",redactedText:S,findings:c}}var nt=[{pattern:/ignore previous instructions/i,score:.9,name:"IGNORE_PREVIOUS"},{pattern:/system override/i,score:.9,name:"SYSTEM_OVERRIDE"},{pattern:/\bDAN\b/i,score:.6,name:"DAN_MODE"},{pattern:/dev mode/i,score:.7,name:"DEV_MODE"},{pattern:/act as a/i,score:.3,name:"ACT_AS"},{pattern:/you are unrestricted/i,score:.95,name:"UNRESTRICTED"},{pattern:/disable safety procedures/i,score:1,name:"DISABLE_SAFETY"}];function H(i){let s=0,r=!1,a="";for(let o of nt)o.pattern.test(i)&&o.score>s&&(s=o.score,r=!0,a=`Detected pattern: ${o.name}`);return{score:s,isDetected:r,reason:r?a:void 0}}function at(i){if(!i)return 0;let s={},r=i.length;for(let o=0;o<r;o++){let l=i[o];s[l]=(s[l]||0)+1}let a=0;for(let o in s){let l=s[o]/r;a-=l*Math.log2(l)}return a}function J(i,s=5.2){let r=i.split(/\s+/),a=[];for(let o of r){if(o.length<8)continue;let l=at(o);l>s&&a.push({score:l,isHighEntropy:!0,text:o})}return a}function z(i){if(!i)return"";let s=i.trim();return s=s.replace(/^```[a-zA-Z]*\s*/,""),s=s.replace(/\s*```$/,""),s}function U(i,s={}){if(!i)return"";let{last:r=!0}=s,a=i;a=a.replace(/<think>[\s\S]*?<\/think>/gi,""),a=a.replace(/<think>[\s\S]*$/gi,""),a=a.replace(/<\/th$/gi,"");let o=/```(?:json|json5|javascript|js)?\s*([\s\S]*?)(?:```|$)/gi,l=[],S;for(;(S=o.exec(a))!==null;){let A=S[1].trim();A&&(A.startsWith("{")||A.startsWith("["))&&l.push(A)}if(l.length>0)return r?l[l.length-1]:l[0];let c=[],g=0,R=-1,b=!1,f=!1;for(let A=0;A<a.length;A++){let d=a[A];if(f){f=!1;continue}if(d==="\\"&&b){f=!0;continue}if(d==='"'&&!f){b=!b;continue}b||(d==="{"||d==="["?(g===0&&(R=A),g++):(d==="}"||d==="]")&&(g--,g===0&&R!==-1&&(c.push(a.slice(R,A+1)),R=-1)))}if(R!==-1&&g>0&&c.push(a.slice(R)),c.length>0)return r?c[c.length-1]:c[0];let m=a.indexOf("{"),y=a.indexOf("[");if(m===-1&&y===-1)return a.trim();let _=m===-1?y:y===-1?m:Math.min(m,y);return a.slice(_).trim()}function le(i,s={}){let{extract:r=!1}=s,a=r?U(i):z(i);if(!a||!a.trim())return{fixed:"{}",data:{},isPartial:!1,patches:[]};let o=a.trim(),l=[],S=!1,c=[],g=!1,R=!1;for(let f=0;f<o.length;f++){let m=o[f];if(R){R=!1;continue}if(m==="\\"&&g){R=!0;continue}if(m==='"'&&!R){g=!g,g?c.push('"'):c.length>0&&c[c.length-1]==='"'&&c.pop();continue}g||(m==="{"?c.push("{"):m==="["?c.push("["):m==="}"?c.length>0&&c[c.length-1]==="{"&&c.pop():m==="]"&&c.length>0&&c[c.length-1]==="["&&c.pop())}if(g&&(l.push({type:"unclosed_string",index:o.length}),o+='"',S=!0,c.length>0&&c[c.length-1]==='"'&&c.pop()),/,\s*$/.test(o)){let f=o.match(/,\s*$/);l.push({type:"trailing_comma",index:f.index}),o=o.replace(/,\s*$/,""),S=!0}for(;c.length>0;){let f=c.pop();f==="{"?(l.push({type:"missing_brace",index:o.length}),o+="}",S=!0):f==="["&&(l.push({type:"missing_brace",index:o.length}),o+="]",S=!0)}let b=null;try{b=JSON.parse(o)}catch{}return{fixed:o,data:b,isPartial:S,patches:l}}var F=null,pe=null,Ae=!0,q="";async function ct(){if(!F){if(!Ae)throw new Error("Wasm Kernel is disabled in this build.");try{let i=await Promise.resolve().then(()=>(ue(),fe));F=await(i.default||i)(),pe=F.cwrap("repair_json","string",["string"])}catch(i){throw console.error("Failed to load Wasm kernel:",i),i}}}self.onmessage=async i=>{let{id:s,type:r,payload:a,options:o}=i.data;try{let l;switch(r){case"SCAN_STREAM_CHUNK":q+=typeof a=="string"?a:"";let c=q,g=$(c,o?.pii||{}),R=H(c),b=J(c);l={safe:!g.hasPII&&!R.isDetected,pii:g,injection:R,entropy:b,textLength:c.length};break;case"RESET_STREAM":q="",l={success:!0};break;case"SCAN_TEXT":{let y=typeof a=="string"?a:a.text,_=$(y,o?.pii||{}),A=H(y),d=J(y);l={safe:!_.hasPII&&!A.isDetected,pii:_,injection:A,entropy:d}}break;case"REPAIR_JSON":{let y=typeof a=="string"?a:a?.text,_=o?.extract??a?.extract??!1,A=o?.useWasm&&Ae,d;if(A){F||await ct();let j=_?U(y):z(y);d={fixed:pe(j),data:null,isPartial:!1,patches:[]}}else d=le(y,{extract:_});let I=d.data,x=!0;if(I===null&&d.fixed!=="null")try{I=JSON.parse(d.fixed)}catch{x=!1}l={fixedString:d.fixed,data:I,isValid:x,isPartial:d.isPartial,patches:d.patches,mode:A?"wasm":"js"}}break;case"EXTRACT_JSON":let f=typeof a=="string"?a:a?.text,m=o?.last??a?.last??!0;l={extracted:U(f,{last:m})};break;default:throw new Error(`Unknown message type: ${r}`)}self.postMessage({id:s,success:!0,payload:l})}catch(l){self.postMessage({id:s,success:!1,error:l.message})}};})();
